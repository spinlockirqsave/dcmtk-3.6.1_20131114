<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DCMTK: dcmrecv: Simple DICOM storage SCP (receiver)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DCMTK
   &#160;<span id="projectnumber">Version 3.6.1 20131114</span>
   </div>
   <div id="projectbrief">OFFIS DICOM Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">dcmrecv: Simple DICOM storage SCP (receiver) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="synopsis"></a>
SYNOPSIS</h1>
<pre class="fragment">dcmrecv [options] port
</pre><h1><a class="anchor" id="description"></a>
DESCRIPTION</h1>
<p>The <b>dcmrecv</b> application implements a Service Class Provider (SCP) for the Storage Service Class. In contrast to the well-known <b>storescp</b> utility, <b>dcmrecv</b> has less options and might, therefore, be easier to use - this also explains the term "simple" in the title. The main purpose of this application is to receive a whole bunch of DICOM datasets from a Storage Service Class User (SCU) and store them to a configurable directory and file structure.</p>
<h1><a class="anchor" id="parameters"></a>
PARAMETERS</h1>
<pre class="fragment">port  tcp/ip port number to listen on
</pre><h1><a class="anchor" id="options"></a>
OPTIONS</h1>
<h2><a class="anchor" id="general_options"></a>
general options</h2>
<pre class="fragment">  -h    --help
          print this help text and exit

        --version
          print version information and exit

        --arguments
          print expanded command line arguments

  -q    --quiet
          quiet mode, print no warnings and errors

  -v    --verbose
          verbose mode, print processing details

  -d    --debug
          debug mode, print debug information

  -ll   --log-level  [l]evel: string constant
          (fatal, error, warn, info, debug, trace)
          use level l for the logger

  -lc   --log-config  [f]ilename: string
          use config file f for the logger

  +v    --verbose-pc
          show presentation contexts in verbose mode
</pre><h2><a class="anchor" id="network_options"></a>
network options</h2>
<pre class="fragment">association negotiation profile from configuration file:

  -xf   --config-file  [f]ilename, [p]rofile: string
          use profile p from configuration file f

application entity title:

  -aet  --aetitle  [a]etitle: string
          set my AE title (default: DCMRECV)

  -uca  --use-called-aetitle
          always respond with called AE title

other network options:

  -ta   --acse-timeout  [s]econds: integer (default: 30)
          timeout for ACSE messages

  -td   --dimse-timeout  [s]econds: integer (default: unlimited)
          timeout for DIMSE messages

  -pdu  --max-pdu  [n]umber of bytes: integer (4096..131072)
          set max receive pdu to n bytes (default: 16384)

  -dhl  --disable-host-lookup  disable hostname lookup
</pre><h2><a class="anchor" id="output_options"></a>
output options</h2>
<pre class="fragment">general:

  -od   --output-directory  [d]irectory: string (default: ".")
          write received objects to existing directory d

subdirectory generation:

  -s    --no-subdir
          do not generate any subdirectories (default)

  +ssd  --series-date-subdir
          generate subdirectories from series date

filename generation:

  +fd   --default-filenames
          generate filename from instance UID (default)

  +fu   --unique-filenames
          generate unique filename based on new UID

  +fsu  --short-unique-names
          generate short pseudo-random unique filename

  +fst  --system-time-names
          generate filename from current system time

  -fe   --filename-extension  [e]xtension: string (default: none)
          append e to all generated filenames

storage mode:

  -B    --normal
          allow implicit format conversions (default)

  +B    --bit-preserving
          write dataset exactly as received

        --ignore
          ignore dataset, receive but do not store it
</pre><h1><a class="anchor" id="notes"></a>
NOTES</h1>
<h2><a class="anchor" id="typical_usage"></a>
Typical Usage</h2>
<p>A typical use case of <b>dcmrecv</b> is to receive SOP instances that are sent from a storage SCU and save them as DICOM files. The following command does exactly this:</p>
<pre class="fragment">dcmrecv --verbose &lt;port&gt; --config-file storescp.cfg default
</pre><p>If you prefer some automatically created subdirectory structure, shorter file names and the extension ".dcm" for all DICOM files, use the following command:</p>
<pre class="fragment">dcmrecv -v -xf storescp.cfg default &lt;port&gt; --series-date-subdir
                                           --short-unique-names
                                           --filename-extension .dcm
</pre><p>In case of very large SOP instances or if the dataset should be written exactly as received (e.g. for debugging purposes), the "bit preserving mode" could be used:</p>
<pre class="fragment">dcmrecv -v -xf storescp.cfg default &lt;port&gt; --bit-preserving
</pre><p>The received datasets are always stored as DICOM files with the same Transfer Syntax as used for the network transmission.</p>
<h2><a class="anchor" id="dicom_conformance"></a>
DICOM Conformance</h2>
<p>Basically, the <b>dcmrecv</b> application supports all Storage SOP Classes as an SCP, including private ones. This requires, however, that a corresponding association negotiation profile is loaded from a configuration file. The format and semantics of this configuration file are documented in <em>asconfig.txt</em>.</p>
<p>By default, that means if no association negotiation profile is loaded, <b>dcmrecv</b> only supports the Verification SOP Class as an SCP (with default transfer syntax, i.e. Implicit VR Litte Endian).</p>
<p>In the future, there might be additional options that allow for specifying the list of supported Presentation Contexts (i.e. combination of SOP Class and Transfer Syntaxes) directly, i.e. without loading a configuration file.</p>
<h2><a class="anchor" id="subdirectory_generation"></a>
Subdirectory Generation</h2>
<p>The option <em>&ndash;series-date-subdir</em> allows for generating subdirectories (below the specified output directory) based on the value of the data element Series Date (0008,0021) from the received DICOM dataset. If this value could be retrieved from the dataset and is valid (i.e. consists of a valid DICOM date field), the subdirectory structure is as follows:</p>
<pre class="fragment">&lt;output-directory&gt;/data/&lt;year&gt;/&lt;month&gt;/&lt;day&gt;/&lt;filename&gt;
</pre><p>If the Series Date (0008,0021) cannot be retrieved or is invalid, the current system date is used for the following subdirectory structure:</p>
<pre class="fragment">&lt;output-directory&gt;/undef/&lt;year&gt;&lt;month&gt;&lt;day&gt;/&lt;filename&gt;
</pre><p>In both cases, &lt;year&gt; consists of 4 decimal digits and &lt;month&gt; as well as &lt;day&gt; of 2 decimal digits.</p>
<h2><a class="anchor" id="filename_generation"></a>
Filename Generation</h2>
<p>By default, the filenames for storing the received DICOM datasets are generated according to the following scheme:</p>
<pre class="fragment">&lt;short-modality-prefix&gt;.&lt;sop-instance-uid&gt;&lt;filename-extension&gt;
</pre><p>If the same SOP instance is received twice, a warning message is reported and the existing file is overwritten.</p>
<p>The option <em>&ndash;unique-filenames</em> makes sure that each received DICOM dataset is stored as a separate file, i.e. no files should ever be overwritten. This is done by using a newly created unique identifier (UID) for each generated filename (and the infix ".X" in order to avoid conflicts with real SOP Instance UID values). The naming scheme for this option is as follows:</p>
<pre class="fragment">&lt;short-modality-prefix&gt;.X.&lt;unique-identifier&gt;&lt;filename-extension&gt;
</pre><p>When option <em>&ndash;short-unique-names</em> is used, the filenames are generated by some pseudo-random name generator, which also makes sure that there are no conflicts (i.e. existing files are not overwritten). This is the naming scheme:</p>
<pre class="fragment">&lt;short-modality-prefix&gt;_&lt;pseudo-random-name&gt;&lt;filename-extension&gt;
</pre><p>With &lt;pseudo-random-name&gt; consisting of 16 digits in hexadecimal notation.</p>
<p>Finally, option <em>&ndash;system-time-names</em> allows for generating filenames based on the current system time:</p>
<pre class="fragment">&lt;date&gt;&lt;time&gt;.&lt;short-modality-prefix&gt;&lt;filename-extension&gt;
</pre><p>With &lt;date&gt; consisting of "&lt;year&gt;&lt;month&gt;&lt;day&gt;" and &lt;time&gt; of "&lt;hour&gt;&lt;minute&gt;&lt;second&gt;.&lt;micro-second&gt;". Please note that this scheme could result in naming conflicts if the resolution of the system time is not sufficiently high (i.e. does not support microseconds).</p>
<h2><a class="anchor" id="limitations"></a>
Limitations</h2>
<p>Please note that option <em>&ndash;bit-preserving</em> cannot be used together with option <em>&ndash;series-date-subdir</em> since the received dataset is stored directly to file and the value of the Series Date (0008,0021) is, therefore, not available before the file has been created.</p>
<h1><a class="anchor" id="logging"></a>
LOGGING</h1>
<p>The level of logging output of the various command line tools and underlying libraries can be specified by the user. By default, only errors and warnings are written to the standard error stream. Using option <em>&ndash;verbose</em> also informational messages like processing details are reported. Option <em>&ndash;debug</em> can be used to get more details on the internal activity, e.g. for debugging purposes. Other logging levels can be selected using option <em>&ndash;log-level</em>. In <em>&ndash;quiet</em> mode only fatal errors are reported. In such very severe error events, the application will usually terminate. For more details on the different logging levels, see documentation of module "oflog".</p>
<p>In case the logging output should be written to file (optionally with logfile rotation), to syslog (Unix) or the event log (Windows) option <em>&ndash;log-config</em> can be used. This configuration file also allows for directing only certain messages to a particular output stream and for filtering certain messages based on the module or application where they are generated. An example configuration file is provided in <em>&lt;etcdir&gt;/logger.cfg</em>).</p>
<h1><a class="anchor" id="command_line"></a>
COMMAND LINE</h1>
<p>All command line tools use the following notation for parameters: square brackets enclose optional values (0-1), three trailing dots indicate that multiple values are allowed (1-n), a combination of both means 0 to n values.</p>
<p>Command line options are distinguished from parameters by a leading '+' or '-' sign, respectively. Usually, order and position of command line options are arbitrary (i.e. they can appear anywhere). However, if options are mutually exclusive the rightmost appearance is used. This behaviour conforms to the standard evaluation rules of common Unix shells.</p>
<p>In addition, one or more command files can be specified using an '@' sign as a prefix to the filename (e.g. <em>@command.txt</em>). Such a command argument is replaced by the content of the corresponding text file (multiple whitespaces are treated as a single separator unless they appear between two quotation marks) prior to any further evaluation. Please note that a command file cannot contain another command file. This simple but effective approach allows to summarize common combinations of options/parameters and avoids longish and confusing command lines (an example is provided in file <em>&lt;datadir&gt;/dumppat.txt</em>).</p>
<h1><a class="anchor" id="exit_codes"></a>
EXIT CODES</h1>
<p>The <b>dcmrecv</b> utility uses the following exit codes when terminating. This enables the user to check for the reason why the application terminated.</p>
<h2><a class="anchor" id="exit_codes_general"></a>
general</h2>
<pre class="fragment">EXITCODE_NO_ERROR                         0
EXITCODE_COMMANDLINE_SYNTAX_ERROR         1
</pre><h2><a class="anchor" id="exit_codes_input_file_errors"></a>
input file errors</h2>
<pre class="fragment">EXITCODE_CANNOT_READ_INPUT_FILE          20 (*)
</pre><h2><a class="anchor" id="exit_codes_output_file_errors"></a>
output file errors</h2>
<pre class="fragment">EXITCODE_CANNOT_WRITE_OUTPUT_FILE        40 (*)
EXITCODE_INVALID_OUTPUT_DIRECTORY        45
</pre><h2><a class="anchor" id="exit_codes_network_errors"></a>
network errors</h2>
<pre class="fragment">EXITCODE_CANNOT_INITIALIZE_NETWORK       60 (*)
EXITCODE_CANNOT_START_SCP_AND_LISTEN     64
EXITCODE_INVALID_ASSOCIATION_CONFIG      66
</pre><p>(*) Actually, these codes are currently not used by <b>dcmrecv</b> but serve as a placeholder for the corresponding group of exit codes.</p>
<h1><a class="anchor" id="environment"></a>
ENVIRONMENT</h1>
<p>The <b>dcmrecv</b> utility will attempt to load DICOM data dictionaries specified in the <em>DCMDICTPATH</em> environment variable. By default, i.e. if the <em>DCMDICTPATH</em> environment variable is not set, the file <em>&lt;datadir&gt;/dicom.dic</em> will be loaded unless the dictionary is built into the application (default for Windows).</p>
<p>The default behaviour should be preferred and the <em>DCMDICTPATH</em> environment variable only used when alternative data dictionaries are required. The <em>DCMDICTPATH</em> environment variable has the same format as the Unix shell <em>PATH</em> variable in that a colon (":") separates entries. On Windows systems, a semicolon (";") is used as a separator. The data dictionary code will attempt to load each file specified in the <em>DCMDICTPATH</em> environment variable. It is an error if no data dictionary can be loaded.</p>
<h1><a class="anchor" id="files"></a>
FILES</h1>
<p><em>&lt;docdir&gt;/asconfig.txt</em> - configuration file documentation <br/>
<em>&lt;etcdir&gt;/storescp.cfg</em> - example association negotiation profile</p>
<h1><a class="anchor" id="see_also"></a>
SEE ALSO</h1>
<p><b>dcmsend</b>(1), <b>storescu</b>(1), <b>storescp</b>(1)</p>
<h1><a class="anchor" id="copyright"></a>
COPYRIGHT</h1>
<p>Copyright (C) 2013 by OFFIS e.V., Escherweg 2, 26121 Oldenburg, Germany. </p>
</div></div><!-- contents -->
<p>
<hr>
<small>
Generated on Sun Jun 1 2014 for <a href="http://www.dcmtk.org/">DCMTK</a> Version 3.6.1 20131114 by <a href="http://www.doxygen.org/">Doxygen</a> 1.8.1.2
</small>
